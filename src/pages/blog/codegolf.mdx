import { PostLayout } from '../../components/PostLayout';

export const meta = {
  id: 'codegolf',
  title: 'C言語コードゴルフ入門',
};

## コードゴルフとは

少ないストローク数で要件を満たす出力をするプログラムを書くことを競う競技です。コードの安全性は無視し、とにかく短い byte 数でコードを書くことが正義となる競技です。

語源はスポーツのゴルフです。ゴルフはなるべく少ない打数でホールにゴルフボールを入れる競技ですが、その競技の性質をなぞってコードゴルフと名付けられました。

## FizzBuzz

ここでは、現状世界で最も短いと言われる FizzBuzz のコード(C(gcc7.5.0))を紹介します。最短は 74byte です。

> $i\space(1\leq{i}\leq{100})$行標準出力に出力します。$i$が 3 の倍数ならば`Fizz`、5 の倍数ならば`Buzz`、3 の倍数かつ 5 の倍数ならば`FizzBuzz`、それ以外の場合は$i$を出力してください。

これを素直に実装すると、例えば次のようになります。このコードには短くなるポイントが沢山あります。

```c
#include <stdio.h>

int main(void){
    for(int i = 1; i <= 100; i++){
        if(i % 3 == 0 && i % 5 == 0) printf("FizzBuzz\n");
        else if(i % 3 == 0) printf("Fizz\n");
        else if(i % 5 == 0) printf("Buzz\n");
        else printf("%d\n", i);
    }
    return 0;
}
```

## level 1. 誰でも思いつきそうな技

### 1. スペース・インデント・改行をなくす

適切なスペース・インデント・改行のないコードは読みづらく悪とされがちですが、コードゴルフでは短ければ正義です。

### 2. `return 0;`はいらない

C99 では`return 0;`を省略してもデフォルトで 0 を返してくれます。

### 3. main(void)→main()

main 関数さえあれば動きます。

## level 2. 少し知識が必要？

### 1. 三項演算子を使う

`（条件式 ? trueの時に実行される文 : falseの時に実行される文）` で if 文と同じことができます。

### 2. 名前の短い関数を使う

一般的に標準出力には`printf`関数が使われがちですが、文字列のみを出力するなら`puts`関数の方が短いです。さらに`puts`関数は改行もしてくれるので、末尾に`\n`も不要です。

### 3. 条件式はなるべく短く

`==`はこれだけで 2byte もありますが、否定演算子`!`を使うと短く書けることがあります。C では条件式の結果が**0 なら偽、0 以外は真**となります。

ここまでのポイントをコードに反映すると、次のようになります。

```c
#include<stdio.h>
int main(){for(int i=1;i<=100;i++)printf(i%3?i%5?"%d\n":"Buzz\n":i%5?"Fizz\n":"FizzBuzz\n",i);}
```

## level 3. 知らないと無理そう(当社比)

### 1. #include は必要ない

ヘッダファイルには使われる関数のプロトタイプ宣言がなされていますが、C 言語では実はプロトタイプ宣言は必要ないため、include が不要です。

### 2. 型が省略されたグローバル識別子は int 型とみなされる

グローバルで宣言した型なしの識別子は int 型と勝手にみなされます。これにより型宣言を省略して短くかけることがあります。

### 3. main 関数の仮引数を使う

```c
main(int argc, char* argv[])
```

の argc や argv を用いる、ということです。argc は初期値が 1 であることに注意してください。

### 4. for 文などのスコープの省略

式はカンマ(,)でつなげて書くことができるので、例えば

```c
for(int i=0;i<n;i++)printf("a"),printf("i");
```

のようにかけます。以上をコードに反映してみましょう。

```c
main(i){for(i=1;i<=100;i++)printf(i%3?i%5?"%d\n":"Buzz\n":i%5?"Fizz\n":"FizzBuzz\n",i);}
```

まだまだ短くなるポイントがあるので、ドンドン見ていきましょう。

## level 4. 1byte1byte 丁寧丁寧丁寧に削る

### 1. `<=`より`<`を使う

for 文の中の`<=100`ですが、`<101`の方が 1byte 短いですし、動作も同じです。

### 2. "Fizz","Buzz"の出力順

現在コード内では`"Fizz","Buzz","FizzBuzz"`の三種類の文字列を埋め込んでいますが、これを`"Fizz"`と`"Buzz"`を出力するパートをそれぞれ分けてみます。

```c
// Fizz
if(i % 3) {
    if(i % 5) printf("%d",i);
    else printf("Fizz");
}
// Buzz
if(i % 5) puts("");
else puts("Buzz");
```

これと for 文の()の中身をうまく使うと短く書けて、例えば

```c
for(;i<101;puts(i++%5?"":"Buzz"))printf(i%3?i%5?"%d":"":"Fizz",i);
```

のようになります。インクリメントの使い方も重要です。

### 3. printf(0);

printf()関数には実は返り値があります。標準出力が成功した場合は書き出された文字数、失敗した場合は負の値が返ってきます。これを用いて、条件分岐で何も出力しない場合に`""`を出力するよりも、`0`を引数に入れたほうが 1byte 縮みます。

以上のテクを用いてコードを書くと次のようになります。これで 74byte となり、完成です。

```c
main(i){for(;i<101;puts(i++%5?"":"Buzz"))printf(i%3?i%5?"%d":0:"Fizz",i);}
```

export default ({ children }) => <PostLayout meta={meta}>{children}</PostLayout>;